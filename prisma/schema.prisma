generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id        String       @id @default(cuid())
  email     String       @unique
  password  String
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  role      String       @default("user")
  username  String?      @unique
  profile   UserProfile?
}

model UserProfile {
  id              String        @id @default(cuid())
  userId          String        @unique
  fullName        String?
  phone           String?
  birthday        DateTime?
  nationality     String?
  educationData   Json?
  experiencesData Json?
  essaysData      Json?
  additionalData  Json?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  applications    Application[]
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model SchoolFormTemplate {
  id           String        @id @default(cuid())
  schoolId     String        @unique
  schoolName   String
  program      String
  description  String?
  fieldsData   Json
  isActive     Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  category     String?       @default("国际学校")
  applications Application[]
}

model Application {
  id          String             @id @default(cuid())
  profileId   String
  templateId  String
  formData    Json
  status      String             @default("draft")
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  submittedAt DateTime?
  profile     UserProfile        @relation(fields: [profileId], references: [id], onDelete: Cascade)
  template    SchoolFormTemplate @relation(fields: [templateId], references: [id], onDelete: NoAction)

  @@index([profileId])
  @@index([templateId])
}

model AIConversation {
  id            String   @id @default(cuid())
  userId        String
  applicationId String?
  messages      Json
  context       Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([userId])
}

model ApplicationData {
  id        String   @id @default(cuid())
  schoolId  String
  userId    String
  data      Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([schoolId, userId])
  @@index([schoolId])
  @@index([userId])
}
