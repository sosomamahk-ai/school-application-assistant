# 🔧 连接错误修复指南

## 🔍 问题诊断

如果遇到 "Connection error" 或 "ENOTFOUND" 错误，但浏览器可以访问 Worker URL，这通常是本地 DNS 或网络配置问题。

### 错误特征

- ✅ Worker 已部署（浏览器可以访问）
- ✅ 环境变量已配置（OPENAI_BASE_URL 已设置）
- ❌ Node.js 环境下 DNS 解析失败（ENOTFOUND）

## ✅ 解决方案

### 方案 1：刷新 DNS 缓存（推荐）

在 Windows 上运行：

```bash
ipconfig /flushdns
```

然后重新测试。

### 方案 2：重启应用

**重要**：即使本地测试失败，应用在生产环境中可能仍然可用。

1. **停止应用**（Ctrl+C）
2. **重新启动应用**：
   ```bash
   npm run dev
   ```
3. **测试扫描功能**

### 方案 3：检查防火墙设置

确保防火墙没有阻止 Node.js 的网络访问：

1. Windows 防火墙设置
2. 允许 Node.js 通过防火墙
3. 允许出站连接

### 方案 4：使用不同的 DNS 服务器

如果 DNS 解析一直失败，可以尝试使用公共 DNS：

1. **使用 Google DNS** (8.8.8.8)
2. **使用 Cloudflare DNS** (1.1.1.1)
3. **修改网络适配器设置**

## 🧪 验证 Worker 是否工作

虽然本地测试失败，但可以通过以下方式验证：

### 方法 1：浏览器测试

访问以下 URL：
```
https://openai-proxy.sosomamahk.workers.dev/v1/models
```

如果看到 JSON 响应（即使是 401），说明 Worker 正常工作。

### 方法 2：应用测试

1. 重启应用（加载环境变量）
2. 尝试扫描模板
3. 如果不再看到连接错误，说明一切正常

## 📝 重要提示

### 本地测试失败 ≠ 应用无法工作

- ✅ Worker 已部署并可以访问（浏览器验证）
- ✅ 配置正确（环境变量已设置）
- ⚠️ 本地 DNS 解析失败（可能是本地网络问题）

**即使本地测试失败，应用在生产环境中可能仍然可用！**

### 应用未重启 = 配置未加载

**最重要**：环境变量只在应用启动时加载。如果修改了 `.env` 文件，必须重启应用！

```bash
# 停止应用（Ctrl+C）
npm run dev
```

## ✅ 快速检查清单

在尝试扫描之前：

- [x] Worker 已部署（浏览器测试通过 ✅）
- [x] 环境变量已配置（OPENAI_BASE_URL 已设置 ✅）
- [x] Worker 代码正确（返回正确的错误消息 ✅）
- [ ] 应用已重启（**重要**！）
- [ ] DNS 缓存已刷新（可选）

## 🚀 下一步

1. **刷新 DNS 缓存**（如果可能）
2. **重启应用**（最重要！）
3. **测试扫描功能**
4. 如果仍有问题，查看应用日志中的详细错误信息

## 💡 提示

如果应用仍然报错，即使 Worker 已部署，可能的原因是：

1. **应用未重启**（环境变量未加载）- 最常见的原因
2. **本地 DNS 问题**（但生产环境可能可用）
3. **防火墙阻止**（检查防火墙设置）

**最重要的是确保应用已重启！**

---

祝您使用愉快！🎉

