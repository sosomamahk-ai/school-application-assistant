# 服务器连接问题解决指南

## 问题：Unable to connect to the remote server

### 诊断结果
- ✗ 端口3000无法连接
- ✓ 有Node进程在运行

这说明：**服务器可能崩溃了或没有正确启动**

## 解决方案

### 步骤1：检查服务器状态

在运行 `npm run dev` 的终端中查看：
- 是否有错误信息？
- 是否显示 "Ready" 或 "Local: http://localhost:3000"？
- 是否有任何错误堆栈？

### 步骤2：重启开发服务器

1. **停止当前服务器**：
   - 在运行 `npm run dev` 的终端中按 `Ctrl+C`
   - 或者关闭该终端窗口

2. **清理Node进程**（如果Ctrl+C不起作用）：
   ```powershell
   Get-Process node | Stop-Process -Force
   ```

3. **重新启动服务器**：
   ```powershell
   npm run dev
   ```

4. **等待服务器完全启动**：
   看到类似这样的输出：
   ```
   ✓ Ready in 2.3s
   ○ Local: http://localhost:3000
   ```

### 步骤3：验证服务器运行

在浏览器中访问：
```
http://localhost:3000
```

如果能看到页面，说明服务器正常运行。

### 步骤4：再次运行同步脚本

服务器启动后，再次运行：
```powershell
.\scripts\sync-schools-with-retry.ps1
```

## 常见原因

### 原因1：服务器崩溃
- **症状**：Node进程存在但端口无法连接
- **解决**：重启服务器

### 原因2：端口被占用
- **症状**：启动时显示端口已被占用
- **解决**：
  ```powershell
  # 查找占用3000端口的进程
  netstat -ano | findstr :3000
  
  # 停止占用端口的进程（替换PID）
  taskkill /PID <进程ID> /F
  ```

### 原因3：服务器启动失败
- **症状**：启动时显示错误
- **解决**：查看错误信息，常见问题：
  - 数据库连接失败
  - 环境变量缺失
  - 端口冲突

## 快速修复命令

```powershell
# 1. 停止所有Node进程
Get-Process node -ErrorAction SilentlyContinue | Stop-Process -Force

# 2. 等待2秒
Start-Sleep -Seconds 2

# 3. 重新启动服务器（在新终端中）
npm run dev

# 4. 等待看到 "Ready" 消息后，运行同步脚本
.\scripts\sync-schools-with-retry.ps1
```

## 验证步骤

1. **检查服务器是否运行**：
   ```powershell
   .\scripts\test-server-connection.ps1
   ```

2. **在浏览器中访问**：
   ```
   http://localhost:3000
   ```

3. **如果能看到页面，服务器正常运行**

## 如果问题持续

如果重启后仍然无法连接：

1. **检查防火墙**：确保没有阻止localhost:3000
2. **检查代理设置**：如果有代理，可能需要配置
3. **查看详细错误**：在dev服务器终端中查看完整错误信息
4. **尝试其他端口**：修改 `.env` 或 `package.json` 中的端口

## 下一步

服务器正常运行后：
1. 运行 `.\scripts\sync-schools-with-retry.ps1`
2. 输入邮箱和密码
3. 等待同步完成（15-30分钟）

