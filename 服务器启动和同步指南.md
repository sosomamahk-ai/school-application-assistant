# 服务器启动和同步指南

## 问题：Login request failed: Unable to connect to the remote server

这个错误表示Next.js开发服务器没有运行。

## 快速解决方案

### 方法1：使用自动启动脚本（推荐）

```powershell
# 1. 停止所有Node进程
Get-Process -Name node -ErrorAction SilentlyContinue | Stop-Process -Force

# 2. 启动开发服务器（端口3002）
npm run dev -- -p 3002
```

或者使用自动脚本：
```powershell
.\scripts\fix-ports-and-start.ps1
```

### 方法2：手动启动

1. **停止所有Node进程**：
   ```powershell
   Get-Process -Name node -ErrorAction SilentlyContinue | Stop-Process -Force
   ```

2. **启动开发服务器**：
   ```powershell
   npm run dev -- -p 3002
   ```

3. **等待服务器启动**（看到 "Ready" 消息）

4. **在新终端运行同步脚本**：
   ```powershell
   .\scripts\sync-schools-with-retry.ps1
   ```

## 验证服务器是否运行

### 检查端口

```powershell
# 检查端口3002
Test-NetConnection localhost -Port 3002

# 应该返回: TcpTestSucceeded : True
```

### 检查浏览器

打开浏览器访问：
- http://localhost:3002

应该看到应用首页。

## 常见问题

### 1. 端口被占用

如果端口3002被占用：

```powershell
# 查看占用端口的进程
netstat -ano | findstr ":3002"

# 停止占用端口的进程（替换PID为实际进程ID）
Stop-Process -Id <PID> -Force
```

### 2. 服务器启动失败

检查：
- Node.js版本是否正确
- 依赖是否安装完整：`npm install`
- 环境变量是否正确设置

### 3. 同步脚本仍然无法连接

确保：
- 服务器完全启动（看到 "Ready" 消息）
- 使用正确的端口（默认3002）
- 防火墙没有阻止连接

## 完整流程

1. **启动服务器**：
   ```powershell
   npm run dev -- -p 3002
   ```

2. **等待服务器就绪**（看到 "Ready" 消息）

3. **在新终端运行同步**：
   ```powershell
   .\scripts\sync-schools-with-retry.ps1
   ```

4. **查看同步进度**：
   - 同步脚本会显示进度
   - 服务器终端会显示详细日志

5. **验证结果**：
   ```powershell
   npx prisma studio
   ```
   打开School表，检查nameShort列

## 提示

- **保持服务器运行**：同步过程中不要关闭开发服务器
- **查看日志**：服务器终端会显示详细的同步日志
- **调试信息**：如果name_short仍然为null，查看服务器日志中的调试信息

